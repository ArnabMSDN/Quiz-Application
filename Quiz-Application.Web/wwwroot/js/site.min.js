function ShowImagePreview(n){if(n.files&&n.files[0]){var t=new FileReader;t.onload=function(n){$("#imgCandidate").prop("src",n.target.result)};t.readAsDataURL(n.files[0])}}$(document).ready(function(){function k(n){for(var t in r)if(r[t].QuestionID==n){r[t].CandidateID=$("#eqCandidateID").text();r[t].ExamID=h;r[t].QuestionID=n;r[t].AnswerID=o;r[t].SelectedOption=$('input[name="option"]:checked').val();break}}function d(n){$.get("/api/Questions",{ExamID:n},function(n){var i,r;u=0;o=0;t=n;i="<div style='padding: 5px;' id='eqOption'>";f=n.questions.length;$("#eqCount").html("(1 of "+f+")");$("div#eqMain h3").html(n.exam+" Quiz");$("div#eqMain h4").html("Question 1 : "+n.questions[0].questionText);u=n.questions[0].questionID;o=n.questions[0].answer.optionID;for(r in n.questions[0].options)i=i+"<input class='w3-radio' type='radio' name='option' value='"+n.questions[0].options[r].optionID+"'><label> "+n.questions[0].options[r].option+"<\/label><br/>";i=i+"<\/div>";$("div#eqMain p").append(i);$("#eqMain button.w3-right").prop("disabled",!1)})}function g(n,t){var i=new Date,r;i.setHours(i.getHours()+n);t.length==0&&(r=setInterval(function(){var t=(new Date).getTime(),n=i.getTime()-t,u=Math.floor(n%864e5/36e5),f=Math.floor(n%36e5/6e4),e=Math.floor(n%6e4/1e3);document.getElementById("timer").innerHTML="Time : "+u+":"+f+":"+e;n<0&&(clearInterval(r),document.getElementById("timer").innerHTML="Time : 00:00:00")},1e3),t.push(r))}function nt(n){clearInterval(n[0]);n=[]}function tt(){var n;e==null?alert("Could not get local stream from mic/camera"):(a=[],console.log("Start recording..."),typeof MediaRecorder.isTypeSupported=="function"?(MediaRecorder.isTypeSupported("video/webm;codecs=vp9")?n={mimeType:"video/webm;codecs=vp9"}:MediaRecorder.isTypeSupported("video/webm;codecs=h264")?n={mimeType:"video/webm;codecs=h264"}:MediaRecorder.isTypeSupported("video/webm")?n={mimeType:"video/webm"}:MediaRecorder.isTypeSupported("video/mp4")&&(b="video/mp4",n={mimeType:"video/mp4"}),console.log("Using "+n.mimeType),i=new MediaRecorder(e,n)):(console.log("isTypeSupported is not supported, using default codecs for browser"),i=new MediaRecorder(e)),i.ondataavailable=function(n){console.log("mediaRecorder.ondataavailable, e.data.size="+n.data.size);n.data&&n.data.size>0&&a.push(n.data)},i.onerror=function(n){console.log("mediaRecorder.onerror: "+n)},i.onstart=function(){console.log("mediaRecorder.onstart, mediaRecorder.state = "+i.state);e.getTracks().forEach(function(n){n.kind=="audio"&&console.log("onstart - Audio track.readyState="+n.readyState+", track.muted="+n.muted);n.kind=="video"&&console.log("onstart - Video track.readyState="+n.readyState+", track.muted="+n.muted)})},i.onstop=function(){console.log("mediaRecorder.onstop, mediaRecorder.state = "+i.state);var n=new Blob(a,{type:i.mimeType});rt(n)},i.onpause=function(){console.log("mediaRecorder.onpause, mediaRecorder.state = "+i.state)},i.onresume=function(){console.log("mediaRecorder.onresume, mediaRecorder.state = "+i.state)},i.onwarning=function(n){console.log("mediaRecorder.onwarning: "+n)},i.start(1e3),e.getTracks().forEach(function(n){console.log(n.kind+":"+JSON.stringify(n.getSettings()));console.log(n.getSettings())}))}function it(){i.stop();l.srcObject=null}function rt(n){var t=new FormData;t.append("video-blob",n);$.ajax({type:"POST",url:"/Home/SaveRecoredFile",data:t,cache:!1,contentType:!1,processData:!1,success:function(n){n&&console.log("Success")},error:function(n){console.log(n)}})}var h=0,c=null,v=null,u=0,o=0,y=0,n=0,f=0,t=[],r=[],p=[],s=null,ut=document.querySelector("button#btnStart"),ft=document.querySelector("button#btnSubmit"),l=document.querySelector("#gum");$("#ddlExam").prop("disabled",!1);$("#btnStart").prop("disabled",!1);$("#btnSubmit").prop("disabled",!1);$("#btnSave").prop("disabled",!0);$("#eqMain button.w3-left").prop("disabled",!0);$("#eqMain button.w3-right").prop("disabled",!0);$("#eqReport").children().prop("disabled",!0);$("#eqReport a").removeAttr("href");$("#eqReport i").addClass("w3-opacity-max");$("#eqScore").children().prop("disabled",!0);var i,a=[],e=null,w=null,b="video/webm";navigator.mediaDevices.getUserMedia?window.MediaRecorder==undefined?alert("MediaRecorder not supported on your browser, use the latest version of Firefox or Chrome"):navigator.mediaDevices.getUserMedia({audio:!0,video:{width:{min:640,ideal:640,max:640},height:{min:480,ideal:480,max:480},framerate:60}}).then(function(n){e=n;e.getTracks().forEach(function(n){n.kind=="audio"&&(n.onended=function(){console.log("audio track.onended Audio track.readyState="+n.readyState+", track.muted="+n.muted)});n.kind=="video"&&(n.onended=function(){log("video track.onended Audio track.readyState="+n.readyState+", track.muted="+n.muted)})});l.srcObject=e;l.play();try{window.AudioContext=window.AudioContext||window.webkitAudioContext;window.audioContext=new AudioContext}catch(t){console.log("Web Audio API not supported.")}w=window.soundMeter=new SoundMeter(window.audioContext);w.connectToSource(e,function(n){if(n){console.log(n);return}})}).catch(function(n){console.log("navigator.getUserMedia error: "+n)}):alert("navigator.mediaDevices.getUserMedia not supported on your browser, use the latest version of Firefox or Chrome");$.ajax({type:"GET",url:"/api/Exams",data:"{}",success:function(n){for(var i='<option value="-1">--- Please Select ---<\/option>',t=0;t<n.length;t++)i+='<option value="'+n[t].examID+'">'+n[t].name+"<\/option>";$("#ddlExam").html(i)}});$("#btnStart").click(function(){$("#ddlExam").val()>0?($("#ddlExam").prop("disabled",!0),$("#btnStart").prop("disabled",!0),$("#btnSave").prop("disabled",!1),h=$("#ddlExam").val(),$.get("/api/Exam/",{ExamID:h},function(n){y=n.duration;g(y,p);tt();d(h)})):$.alert({icon:"fa fa-warning",type:"orange",title:"Select Skill",content:"Please select your skill !",boxWidth:"40%",useBootstrap:!1,closeIcon:!0,closeIconClass:"fa fa-close"})});$("#btnPrev").click(function(){var s,i,e;if(u=0,o=0,n=(n-1)%f,s=n+1,n<=f-1){$("div#eqMain p").empty();i="<div style='padding: 5px;' id='eqOption'>";$("#eqCount").html("("+s+" of "+f+")");$("div#eqMain h3").html(t.exam+" Quiz");$("div#eqMain h4").html("Question "+s+" : "+t.questions[n].questionText);u=t.questions[n].questionID;o=t.questions[n].answer.optionID;let h=r.find(n=>n.QuestionID===u);for(e in t.questions[n].options)i=$.isEmptyObject(h)?i+"<input class='w3-radio' type='radio' name='option' value='"+t.questions[n].options[e].optionID+"'><label> "+t.questions[n].options[e].option+"<\/label><br/>":h.SelectedOption==t.questions[n].options[e].optionID?i+"<input class='w3-radio' type='radio' name='option' value='"+t.questions[n].options[e].optionID+"' checked><label> "+t.questions[n].options[e].option+"<\/label><br/>":i+"<input class='w3-radio' type='radio' name='option' value='"+t.questions[n].options[e].optionID+"'><label> "+t.questions[n].options[e].option+"<\/label><br/>";i=i+"<\/div>";$("div#eqMain p").append(i);$("#eqMain button.w3-right").prop("disabled",!1);n==0&&$("#eqMain button.w3-left").prop("disabled",!0)}});$("#btnNext").click(function(){var s,i,e;if(u=0,o=0,n=(n+1)%f,s=n+1,n<=f-1){$("div#eqMain p").empty();i="<div style='padding: 5px;' id='eqOption'>";$("#eqCount").html("("+s+" of "+f+")");$("div#eqMain h3").html(t.exam+" Quiz");$("div#eqMain h4").html("Question "+s+" : "+t.questions[n].questionText);u=t.questions[n].questionID;o=t.questions[n].answer.optionID;let h=r.find(n=>n.QuestionID===u);for(e in t.questions[n].options)i=$.isEmptyObject(h)?i+"<input class='w3-radio' type='radio' name='option' value='"+t.questions[n].options[e].optionID+"'><label> "+t.questions[n].options[e].option+"<\/label><br/>":h.SelectedOption==t.questions[n].options[e].optionID?i+"<input class='w3-radio' type='radio' name='option' value='"+t.questions[n].options[e].optionID+"' checked><label> "+t.questions[n].options[e].option+"<\/label><br/>":i+"<input class='w3-radio' type='radio' name='option' value='"+t.questions[n].options[e].optionID+"'><label> "+t.questions[n].options[e].option+"<\/label><br/>";i=i+"<\/div>";$("div#eqMain p").append(i);$("#eqMain button.w3-left").prop("disabled",!1);n==f-1&&$("#eqMain button.w3-right").prop("disabled",!0)}});$("#btnSave").click(function(){var n={CandidateID:$("#eqCandidateID").text(),ExamID:h,QuestionID:u,AnswerID:o,SelectedOption:$('input[name="option"]:checked').val()};r.some(n=>n.QuestionID===u)?k(u):r.push(n);n=[]});$("#btnSubmit").click(function(){$.confirm({icon:"fa fa-warning",title:"Submit Quiz",content:"Are you sure you want to submit the quiz ?",type:"orange",closeIcon:!0,closeIconClass:"fa fa-close",boxWidth:"40%",useBootstrap:!1,buttons:{Submit:{text:"Submit",btnClass:"btn-red",action:function(){$.post("/api/Score/",{objRequest:r},function(n){n>0?(nt(p),it(),$("#btnSubmit").prop("disabled",!0),$("#eqReport").children().prop("disabled",!1),$("#eqReport a").attr("href","/Score/Result"),$("#eqReport i").removeClass("w3-opacity-max"),$.alert({type:"green",title:"Success !",content:"Please check the score.",boxWidth:"40%",useBootstrap:!1,closeIcon:!0,closeIconClass:"fa fa-close"})):($("#btnSubmit").prop("disabled",!1),$("#eqReport").children().prop("disabled",!0),$("#eqReport a").removeAttr("href"),$("#eqReport i").addClass("w3-opacity-max"),$.alert({type:"red",title:"Error !",content:"Please try again.",boxWidth:"40%",useBootstrap:!1,closeIcon:!0,closeIconClass:"fa fa-close"}))})}},Cancel:function(){$(this).remove()}}})});$(".btnScore").click(function(){var n={ExamID:$(this).closest("tr").find("td:eq(2)").text(),CandidateID:$("#hdnCandidateID").val(),SessionID:$(this).closest("tr").find("td:eq(1)").text()};c=$(this).closest("tr").find("td:eq(4)").text();v=$(this).closest("tr").find("td:eq(6)").text();$.post("/api/Report/",{argRpt:n},function(n){s=n;$("div#eqScore h3").html(n[0].exam+" Test");$("div#eqScore .w3-container p:eq(0)").html("<strong>Candidate ID:<\/strong> "+n[0].candidateID);$("div#eqScore .w3-container h5").html(n[0].message);$("div#eqScore .w3-container span").html("<strong>Date:<\/strong> "+n[0].date);v=="1"?$("#eqScore").children().prop("disabled",!1):(c=null,s=null,$("#eqScore").children().prop("disabled",!0))})});$("#btnReport").click(function(){var n={ExamID:s[0].examID,CandidateID:$("#hdnCandidateID").val(),SessionID:s[0].sessionID,Exam:s[0].exam,Date:s[0].date,Score:c};$.post("/api/CreatePDF/",{argPDFRpt:n},function(n){(n.isSuccess=!0)&&window.open(n.path,"_blank")})});$("#chooseFile").change(function(){var n=$("#chooseFile")[0].files[0].name;$("#noFile").text(n)})});